function style_html(p,d){var u,n,l,f,g,s;d=d||{};n=d.indent_size||4;l=d.indent_char||" ";g=d.brace_style||"collapse";f=d.max_char==0?Infinity:d.max_char||70;s=d.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"];function c(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(w,t){for(var v=0;v<t.length;v++){if(w===t[v]){return true}}return false}};this.get_content=function(){var t="",w=[],x=false;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length){return w.length?w.join(""):["","TK_EOF"]}t=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(t,this.Utils.whitespace)){if(w.length){x=true}this.line_char_count--;continue}else{if(x){if(this.line_char_count>=this.max_char){w.push("\n");for(var v=0;v<this.indent_level;v++){w.push(this.indent_string)}this.line_char_count=0}else{w.push(" ");this.line_char_count++}x=false}}w.push(t)}return w.length?w.join(""):""};this.get_contents_to=function(w){if(this.pos==this.input.length){return["","TK_EOF"]}var t="";var x="";var y=new RegExp("</"+w+"\\s*>","igm");y.lastIndex=this.pos;var v=y.exec(this.input);var z=v?v.index:this.input.length;if(this.pos<z){x=this.input.substring(this.pos,z);this.pos=z}return x};this.record_tag=function(t){if(this.tags[t+"count"]){this.tags[t+"count"]++;this.tags[t+this.tags[t+"count"]]=this.indent_level}else{this.tags[t+"count"]=1;this.tags[t+this.tags[t+"count"]]=this.indent_level}this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent;this.tags.parent=t+this.tags[t+"count"]};this.retrieve_tag=function(t){if(this.tags[t+"count"]){var v=this.tags.parent;while(v){if(t+this.tags[t+"count"]===v){break}v=this.tags[v+"parent"]}if(v){this.indent_level=this.tags[t+this.tags[t+"count"]];this.tags.parent=this.tags[v+"parent"]}delete this.tags[t+this.tags[t+"count"]+"parent"];delete this.tags[t+this.tags[t+"count"]];if(this.tags[t+"count"]==1){delete this.tags[t+"count"]}else{this.tags[t+"count"]--}}};this.get_tag=function(){var x="",z=[],t=false,B,w;do{if(this.pos>=this.input.length){return z.length?z.join(""):["","TK_EOF"]}x=this.input.charAt(this.pos);this.pos++;this.line_char_count++;if(this.Utils.in_array(x,this.Utils.whitespace)){t=true;this.line_char_count--;continue}if(x==="'"||x==='"'){if(!z[1]||z[1]!=="!"){x+=this.get_unformatted(x);t=true}}if(x==="="){t=false}if(z.length&&z[z.length-1]!=="="&&x!==">"&&t){if(this.line_char_count>=this.max_char){this.print_newline(false,z);this.line_char_count=0}else{z.push(" ");this.line_char_count++}t=false}if(x==="<"){B=this.pos-1}z.push(x)}while(x!==">");var C=z.join("");var v;if(C.indexOf(" ")!=-1){v=C.indexOf(" ")}else{v=C.indexOf(">")}var A=C.substring(1,v).toLowerCase();if(C.charAt(C.length-2)==="/"||this.Utils.in_array(A,this.Utils.single_token)){this.tag_type="SINGLE"}else{if(A==="script"){this.record_tag(A);this.tag_type="SCRIPT"}else{if(A==="style"){this.record_tag(A);this.tag_type="STYLE"}else{if(this.Utils.in_array(A,s)){var y=this.get_unformatted("</"+A+">",C);z.push(y);if(B>0&&this.Utils.in_array(this.input.charAt(B-1),this.Utils.whitespace)){z.splice(0,0,this.input.charAt(B-1))}w=this.pos-1;if(this.Utils.in_array(this.input.charAt(w+1),this.Utils.whitespace)){z.push(this.input.charAt(w+1))}this.tag_type="SINGLE"}else{if(A.charAt(0)==="!"){if(A.indexOf("[if")!=-1){if(C.indexOf("!IE")!=-1){var y=this.get_unformatted("-->",C);z.push(y)}this.tag_type="START"}else{if(A.indexOf("[endif")!=-1){this.tag_type="END";this.unindent()}else{if(A.indexOf("[cdata[")!=-1){var y=this.get_unformatted("]]>",C);z.push(y);this.tag_type="SINGLE"}else{var y=this.get_unformatted("-->",C);z.push(y);this.tag_type="SINGLE"}}}}else{if(A.charAt(0)==="/"){this.retrieve_tag(A.substring(1));this.tag_type="END"}else{this.record_tag(A);this.tag_type="START"}if(this.Utils.in_array(A,this.Utils.extra_liners)){this.print_newline(true,this.output)}}}}}}return z.join("")};this.get_unformatted=function(v,w){if(w&&w.indexOf(v)!=-1){return""}var t="";var x="";var y=true;do{if(this.pos>=this.input.length){return x}t=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(t,this.Utils.whitespace)){if(!y){this.line_char_count--;continue}if(t==="\n"||t==="\r"){x+="\n";this.line_char_count=0;continue}}x+=t;this.line_char_count++;y=true}while(x.indexOf(v)==-1);return x};this.get_token=function(){var t;if(this.last_token==="TK_TAG_SCRIPT"||this.last_token==="TK_TAG_STYLE"){var v=this.last_token.substr(7);t=this.get_contents_to(v);if(typeof t!=="string"){return t}return[t,"TK_"+v]}if(this.current_mode==="CONTENT"){t=this.get_content();if(typeof t!=="string"){return t}else{return[t,"TK_CONTENT"]}}if(this.current_mode==="TAG"){t=this.get_tag();if(typeof t!=="string"){return t}else{var w="TK_TAG_"+this.tag_type;return[t,w]}}};this.get_full_indent=function(t){t=this.indent_level+t||0;if(t<1){return""}return Array(t+1).join(this.indent_string)};this.printer=function(x,w,t,z,y){this.input=x||"";this.output=[];this.indent_character=w;this.indent_string="";this.indent_size=t;this.brace_style=y;this.indent_level=0;this.max_char=z;this.line_char_count=0;for(var v=0;v<this.indent_size;v++){this.indent_string+=this.indent_character}this.print_newline=function(C,A){this.line_char_count=0;if(!A||!A.length){return}if(!C){while(this.Utils.in_array(A[A.length-1],this.Utils.whitespace)){A.pop()}}A.push("\n");for(var B=0;B<this.indent_level;B++){A.push(this.indent_string)}};this.print_token=function(A){this.output.push(A)};this.indent=function(){this.indent_level++};this.unindent=function(){if(this.indent_level>0){this.indent_level--}}};return this}u=new c();u.printer(p,l,n,f,g);while(true){var h=u.get_token();u.token_text=h[0];u.token_type=h[1];if(u.token_type==="TK_EOF"){break}switch(u.token_type){case"TK_TAG_START":u.print_newline(false,u.output);u.print_token(u.token_text);u.indent();u.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":u.print_newline(false,u.output);u.print_token(u.token_text);u.current_mode="CONTENT";break;case"TK_TAG_END":if(u.last_token==="TK_CONTENT"&&u.last_text===""){var r=u.token_text.match(/\w+/)[0];var j=u.output[u.output.length-1].match(/<\s*(\w+)/);if(j===null||j[1]!==r){u.print_newline(true,u.output)}}u.print_token(u.token_text);u.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var a=u.token_text.match(/^\s*<([a-z]+)/i);if(!a||!u.Utils.in_array(a[1],s)){u.print_newline(false,u.output)}u.print_token(u.token_text);u.current_mode="CONTENT";break;case"TK_CONTENT":if(u.token_text!==""){u.print_token(u.token_text)}u.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(u.token_text!==""){u.output.push("\n");var i=u.token_text;if(u.token_type=="TK_SCRIPT"){var o=typeof js_beautify=="function"&&js_beautify}else{if(u.token_type=="TK_STYLE"){var o=typeof css_beautify=="function"&&css_beautify}}if(d.indent_scripts=="keep"){var k=0}else{if(d.indent_scripts=="separate"){var k=-u.indent_level}else{var k=1}}var b=u.get_full_indent(k);if(o){i=o(i.replace(/^\s*/,b),d)}else{var e=i.match(/^\s*/)[0];var m=e.match(/[^\n\r]*$/)[0].split(u.indent_string).length-1;var q=u.get_full_indent(k-m);i=i.replace(/^\s*/,b).replace(/\r\n|\r|\n/g,"\n"+q).replace(/\s*$/,"")}if(i){u.print_token(i);u.print_newline(true,u.output)}}u.current_mode="TAG";break}u.last_token=u.token_type;u.last_text=u.token_text}return u.output.join("")};