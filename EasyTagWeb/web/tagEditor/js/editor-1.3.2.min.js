/*
 * Title                   : Hotspotter Editor App
 * Author                  : Basm , aka z-B
 * Version                 : 1.3.2
 * Last Modified           : 9 April 2013
 * CodeCanyon Profile      : http://codecanyon.net/user/z-B
 * License                 : http://codecanyon.net/licenses/regular_extended
 */
var Draw={$edImg:null,edImg_b:{t:0,b:0,l:0,r:0},parentOffset:{x:0,y:0},mouseCoord:{x:0,y:0},isDraw:false,type:"red-spot",init:function(b){this.$edImg=b;this.$edImg.unbind(".draw");$(document).unbind(".draw");function a(){setTimeout(function(){Draw.$edImg.bind("mousedown.draw",$.proxy(Draw.mousedown,Draw));$(document).bind("mousemove.draw",$.proxy(Draw.start,Draw));$(document).bind("mouseup.draw",$.proxy(Draw.mouseup,Draw))},100)}if(this.$edImg[0].complete){a()}else{this.$edImg.bind("load.draw",a)}},getConstraints:function(){this.edImg_b.t=this.$edImg.offset().top;this.edImg_b.b=this.$edImg.offset().top+this.$edImg.height();this.edImg_b.l=this.$edImg.offset().left;this.edImg_b.r=this.$edImg.offset().left+this.$edImg.width();this.parentOffset.x=this.$edImg.parent().offset().left;this.parentOffset.y=this.$edImg.parent().offset().top},mousedown:function(a){this.getConstraints();if(a.which==1){if(this.type=="sniper-spot"){if((a.pageX<(this.parentOffset.x+this.$edImg.width()-11))&&(a.pageY<(this.parentOffset.y+this.$edImg.height()-11))){Editor.newSpot(new Spot(this.type,a.pageX-this.parentOffset.x-11,a.pageY-this.parentOffset.y-11))}return false}if(this.type=="img-spot"){Editor.newSpot(new Spot(this.type,a.pageX-this.parentOffset.x,a.pageY-this.parentOffset.y));$("#img-spot-dialog").dialog("open");return false}this.isDraw=true;this.mouseCoord.x=a.pageX;this.mouseCoord.y=a.pageY}return false},start:function(c){if(!this.isDraw){return}if(!this.curSpot){this.curSpot=new Spot(this.type,this.mouseCoord.x-this.parentOffset.x,this.mouseCoord.y-this.parentOffset.y)}var b=10,a=10;if(c.pageX>this.edImg_b.l){if(((c.pageX-this.mouseCoord.x)>10)){a=c.pageX-this.mouseCoord.x}if(c.pageX>this.edImg_b.r){a=this.$edImg.width()-parseFloat(this.curSpot.$edSpot.css("left"))}this.curSpot.$edSpot.outerWidth(a)}if(c.pageY>this.edImg_b.t){if(((c.pageY-this.mouseCoord.y)>10)){b=c.pageY-this.mouseCoord.y}if(c.pageY>this.edImg_b.b){b=this.$edImg.height()-parseFloat(this.curSpot.$edSpot.css("top"))}this.curSpot.$edSpot.outerHeight(b)}},mouseup:function(a){this.isDraw=false;if(this.curSpot){Editor.newSpot(this.curSpot);Editor.updateSpotDim();Editor.updateSpotPos();this.curSpot=null}}};var Spot=function(c,b,e){this.spotClass=c;if(c=="sniper-spot"){var d=$("<div/>").addClass(c);this.$edSpot=$("<div/>").css("position","absolute").css("left",b).css("top",e).data("spotObj",this).append(d).appendTo(Editor.$edDiv)}else{this.$edSpot=$("<div/>").addClass(c).css("position","absolute").css("left",b).css("top",e).data("spotObj",this).appendTo(Editor.$edDiv);if(c=="invisible-spot"){this.$edSpot.addClass("invisible-spot-ed")}if(c=="onhover-spot"){this.$edSpot.addClass("onhover-spot-ed")}}this.$hsWrap=$("<div/>").addClass("hs-wrap"),this.$ttWrap=$("<div/>").addClass("tt-wrap");this.$prevSpot=$("<div/>").addClass(c).appendTo(this.$hsWrap);this.$tooltip=$("<div/>").appendTo(this.$ttWrap);this.$ttWrap.appendTo(this.$hsWrap);Editor.$prevDiv.append(this.$hsWrap);if(c=="img-spot"){var a=$("<img/>");this.$edSpot.append(a).append("<img/>");a.css("display","block");this.$prevSpot.append("<img/>").append("<img/>")}this.coord=[b,e];if(c=="sniper-spot"||c=="img-spot"){this.dim=null}else{this.dim=[0,0,0]}this.spLink="";this.spLinknWin=false;this.ttContent="";this.options={spType:"General",spAnim:null,spActiveon:"hover",spName:"",ttType:"tip",ttAnim:"goin",ttDir:"top",ttWidth:"",ttPos:"",ttColor:"black"};if(this.spotClass=="sniper-spot"){this.options.ttPos=-18}};Spot.prototype.flushOptions=function(){this.$hsWrap.removeAttr("style");this.$prevSpot.removeAttr("style");this.$prevSpot.attr("class",this.spotClass);this.$ttWrap.attr("class","tt-wrap");this.$ttWrap.removeAttr("style");this.$tooltip.removeAttr("style").removeData();this.$prevSpot.attr("data-coord",this.coord.join(","));if(this.dim!==null){this.$prevSpot.attr("data-dim",this.dim.join(","))}if(this.options.spType==="Aim"){this.$prevSpot.attr("data-handler","Aim");if(this.options.spAnim=="false"){this.$prevSpot.attr("data-handleropts",this.options.spAnim)}else{this.$prevSpot.removeAttr("data-handleropts")}}else{this.$prevSpot.removeAttr("data-handler");this.$prevSpot.removeAttr("data-handleropts")}this.$prevSpot.attr("data-activeon",this.options.spActiveon);if(this.options.spName){this.$prevSpot.attr("data-name",$.trim(this.options.spName))}else{this.$prevSpot.removeAttr("data-name")}var b=this.$prevSpot.parent(),a;if(this.spLink){if(b[0]!=this.$hsWrap[0]){a=b.attr("href",this.spLink)}else{a=$("<a/>").attr("href",this.spLink).prependTo(this.$hsWrap).append(this.$prevSpot)}if(this.spLinknWin){a.attr("target","_blank")}else{a.removeAttr("target")}}else{if(b[0]!=this.$hsWrap[0]){this.$prevSpot.prependTo(this.$hsWrap);b.remove()}}this.$tooltip.removeClass();if(this.options.spType==="Aim"){this.$tooltip.addClass("aim-tooltip")}else{this.$tooltip.addClass(this.options.ttType+"-tooltip")}if(!this.options.ttAnim||this.options.ttAnim=="none"){this.$tooltip.removeAttr("data-anim")}else{this.$tooltip.attr("data-anim",this.options.ttAnim)}if(this.options.ttDir){this.$tooltip.attr("data-dir",this.options.ttDir)}else{this.$tooltip.removeAttr("data-dir")}if(this.options.ttWidth){this.$tooltip.attr("data-width",parseInt(this.options.ttWidth))}else{this.$tooltip.removeAttr("data-width")}if(this.options.ttPos){this.$tooltip.attr("data-pos",parseInt(this.options.ttPos))}else{this.$tooltip.removeAttr("data-pos")}if(this.options.ttColor=="white"){this.$tooltip.addClass(this.options.ttColor)}if(this.ttContent){if(this.options.spType=="Aim"){this.$tooltip.html("");$("<div/>").addClass("tt-content").html(this.ttContent).appendTo(this.$tooltip)}else{this.$tooltip.html(this.ttContent)}}else{this.$tooltip.html("")}if(this.spotClass=="img-spot"){this.$prevSpot.find("img").removeAttr("style")}};Spot.prototype.select=function(){if(this.spotClass=="glass-spot"||this.spotClass=="shadow-spot"){var f=this.$edSpot.width(),c=this.$edSpot.height();this.$edSpot.width(f-4);this.$edSpot.height(c-4)}if(this.spotClass=="img-spot"){var i=this.$edSpot.find("> img").eq(0),e=this.$edSpot.position().left,a=i.width(),d=this.$edSpot.position().top,g=i.height(),b=Editor.$edImg.width(),j=Editor.$edImg.height();if(Math.round(e+a)==b){this.$edSpot.css("left",e-4)}if(Math.round(d+g)==j){this.$edSpot.css("top",d-4)}}this.$edSpot.addClass("selected")};Spot.prototype.unselect=function(){if(this.spotClass=="glass-spot"||this.spotClass=="shadow-spot"){var f=this.$edSpot.width(),c=this.$edSpot.height();this.$edSpot.width(f+4);this.$edSpot.height(c+4)}if(this.spotClass=="img-spot"){var i=this.$edSpot.find("> img").eq(0),e=this.$edSpot.position().left,a=i.width(),d=this.$edSpot.position().top,g=i.height(),b=Editor.$edImg.width(),j=Editor.$edImg.height();if(Math.round(e+a+4)==b){this.$edSpot.css("left",e+4);Editor.updateSpotPos()}if(Math.round(d+g+4)==j){this.$edSpot.css("top",d+4);Editor.updateSpotPos()}}this.$edSpot.removeClass("selected")};Spot.prototype.del=function(){this.$edSpot.remove();this.$hsWrap.remove()};var Editor={isPreview:false,$edDiv:null,$prevDiv:null,$edImg:null,$prevImg:null,curSpot:null,optionBar:{},spotPool:[],init:function(){this.$edDiv=$(".edit-area");this.$prevDiv=$(".hs-area");this.$edImg=$("#ed-img");this.$prevImg=$("#prev-img");this.isLocalFile=false;this.localFile=null;this.$optionFrm=$("#option-frm");this.optionBar.spType=$("#sp-type");this.optionBar.spAnim=$("#sp-anim");this.optionBar.spActiveon=$("#sp-activeon");this.optionBar.spBradius=$("#sp-bradius");this.optionBar.spName=$("#sp-name");this.optionBar.ttType=$("#tt-type");this.optionBar.ttAnim=$("#tt-anim");this.optionBar.ttDir=$("#tt-dir");this.optionBar.ttWidth=$("#tt-width");this.optionBar.ttPos=$("#tt-pos");this.optionBar.ttColor=$("#tt-color");$("#nimg-btn").bind("click",function(){$("#new-img-dialog").dialog("open")});$("#prev-btn , #end-prev-btn").bind("click",$.proxy(Editor.togglePreview,Editor));$("#gcode-btn").bind("click",$.proxy(Editor.getCode,Editor));$("#load-code-btn").bind("click",function(){$("#load-code-dialog").dialog("open")});this.bindHotKeys();$(".spot-bar button").bind("click",function(){Draw.type=$(this).attr("id").slice(0,-4);Editor.focusSpotBtn(Draw.type)});$("#clone-btn").bind("click",$.proxy(Editor.cloneSpot,Editor));$("#del-btn").bind("click",$.proxy(Editor.delSpot,Editor));$("#link-btn").bind("click",function(){$("#sp-link-dialog").dialog("open")});this.$optionFrm.bind("change",$.proxy(Editor.optionChange,Editor));this.$optionFrm.bind("submit",function(a){a.preventDefault()});$("#tt-content-btn").bind("click",function(){$("#tt-content").val(Editor.curSpot.ttContent);$("#tt-content-dialog").dialog("open")});$("#remove-formatting").bind("click",function(){var a=$("#gcode-txt").val();if($(this).is(":checked")){$("#gcode-txt").val(Editor.removeFormatting(a))}else{$("#gcode-txt").val(style_html(a))}});if(!window.File||!window.FileList||!window.FileReader){$(".html5-local-file").hide()}$("#new-i-d-tabs").tabs();$("#new-img-dialog").dialog({autoOpen:false,modal:true,title:"New Image",resizable:false,show:"drop",hide:"drop",buttons:{Open:$.proxy(Editor.newImage,Editor),Cancel:function(){$(this).dialog("close")}},open:function(){$("#img-url-txt , #img-file-txt").val("")},close:function(){Editor.$edDiv.focus()}});$("#img-file-txt").bind("change",function(a){Editor.localFile=a.target.files[0]});$("#gcode-dialog").dialog({autoOpen:false,modal:true,title:"Get code",resizable:false,width:630,show:"drop",hide:"drop",buttons:{OK:function(){$(this).dialog("close")}},close:function(){$("#gcode-txt").val("");$(this).find(".ui-widget").hide();Editor.$edDiv.focus()}});$("#load-code-dialog").dialog({autoOpen:false,modal:true,title:"Load code",resizable:false,width:630,show:"drop",hide:"drop",buttons:{Load:function(){Editor.loadCode();$(this).dialog("close")},Close:function(){$(this).dialog("close")}},close:function(){Editor.$edDiv.focus()}});$("#gcode-txt").bind("focus",function(){var a=$(this);a.select();a.bind("mouseup",function(){a.unbind("mouseup");return false})});$("#img-spot-dialog").dialog({autoOpen:false,modal:true,title:"Choose Images",resizable:false,width:380,height:200,show:"drop",hide:"drop",buttons:{Save:$.proxy(Editor.imgSpotSave,Editor),Cancel:function(){$(this).dialog("close")}},close:function(){if(!Editor.curSpot.$edSpot.data("img-spot-save")){Editor.delSpot()}$("#imgspot-1 , #imgspot-2").val("");Editor.$edDiv.focus()}});$("#sp-link-dialog").dialog({autoOpen:false,modal:true,title:"Spot Link",resizable:false,show:"drop",hide:"drop",buttons:{Save:function(){Editor.curSpot.spLink=$("#sp-link").val();Editor.curSpot.spLinknWin=$("#sp-link-n-win").is(":checked");$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},open:function(){$("#sp-link").val(Editor.curSpot.spLink);if(Editor.curSpot.spLinknWin){$("#sp-link-n-win").prop("checked",true)}else{$("#sp-link-n-win").prop("checked",false)}},close:function(){Editor.$edDiv.focus()}});$("#tt-content-dialog").dialog({autoOpen:false,modal:true,resizable:false,width:430,title:"Tooltip Content",show:"drop",hide:"drop",buttons:{Save:$.proxy(Editor.ttContentSave,Editor),Cancel:function(){$(this).dialog("close")}},open:function(){$("#tt-content").val(Editor.curSpot.ttContent)},close:function(){Editor.$edDiv.focus()}});$("#error-dialog").dialog({autoOpen:false,modal:true,title:"Error",resizable:false,draggable:false,show:"shake",hide:"fade",buttons:{OK:function(){$(this).dialog("close")}}});$("button").button();$("#sp-bradius").spinner({create:function(){$(this).parent().removeClass("ui-widget-content")},stop:function(){Editor.curSpot.$edSpot.css("border-radius",parseInt($("#sp-bradius").val()))}});$(document).tooltip({position:{my:"center top",at:"left bottom+10",using:function(a){$(this).css(a);$(this).css("font-size","12px")}}})},newImage:function(){var a=$("#img-url-txt").val();if(!a&&!Editor.localFile){this.showError("Choose Image");return}if($("#img-url").css("display")=="block"){Editor.initNewImage(a);Editor.isLocalFile=false}else{if(this.localFile){Editor.initNewImage(Editor.localFile);Editor.isLocalFile=true}}$("#new-img-dialog").dialog("close")},initNewImage:function(a){if(Editor.spotPool.length>0){var c=Editor.spotPool.length-1;do{Editor.spotPool[c].del();delete Editor.spotPool[c]}while(c--);Editor.spotPool=[]}this.$edImg.removeAttr("src");if(typeof a=="string"){this.$edImg.attr("src",a);this.$prevImg.attr("src",a)}else{var b=new FileReader();b.onload=function(d){Editor.$edImg.attr("src",d.target.result);Editor.$prevImg.attr("src",d.target.result)};b.readAsDataURL(a)}Draw.init(Editor.$edImg);Editor.$prevImg.removeAttr("data-imgdim");$(".img-resp-container").show();$(".spot-options").hide();Editor.focusSpotBtn("red-spot");Draw.type="red-spot"},togglePreview:function(){if(this.inPreview){this.inPreview=false;$("#end-prev-btn").hide();window.location.hash="";$(window).unbind(".hotspotter");var e=this.spotPool.length-1,k;do{k=this.spotPool[e];k.$prevSpot.removeData();if(k.options.spType=="Aim"){k.$tooltip.appendTo(Editor.spotPool[e].$ttWrap);k.$tooltip.stop();k.$prevSpot.parents(".hs-area").removeData().find(".hs-aim-rect , .hs-aim-pillar").remove();k.$hsWrap.unbind()}}while(e--);$("#prev-overlay").hide();this.$prevDiv.parent().hide();Editor.$edDiv.focus()}else{if(this.spotPool.length==0){this.showError("There is no spots");return}this.inPreview=true;$("#end-prev-btn").show();if(this.curSpot&&this.curSpot.spotClass=="img-spot"){var m=this.curSpot.$edSpot.find("> img").eq(0),h=this.curSpot.$edSpot.position().left,a=m.width(),f=this.curSpot.$edSpot.position().top,l=m.height(),c=Editor.$edImg.width(),n=Editor.$edImg.height();if(Math.round(h+a+4)==c){this.curSpot.coord[0]=h+4}if(Math.round(f+l+4)==n){this.curSpot.coord[1]=f+4}}if(this.curSpot){this._saveOptions()}var e=this.spotPool.length-1;do{this.spotPool[e].flushOptions()}while(e--);var j=$(window).width(),d=$(window).height(),g=this.$prevDiv.parent().width(),b=this.$prevDiv.parent().height();this.$prevDiv.parent().css("left",(j/2)-(g/2));this.$prevDiv.parent().css("top",(d/2)-(b/2));$("#prev-overlay").show();this.$prevDiv.parent().show();this.$prevDiv.hotspotter()}},getCode:function(){if(!this.spotPool.length){this.showError("There is no spots");return}var m=220;if($("#img-responsive").is(":checked")){var g=this.$edImg.width(),c=this.$edImg.height();this.$prevImg.attr("data-imgdim",[g,c].join(","))}else{this.$prevImg.removeAttr("data-imgdim")}this.$prevImg.removeAttr("id");if(this.curSpot){this._saveOptions()}var d=this.spotPool.length-1;do{this.spotPool[d].flushOptions()}while(d--);if(this.curSpot&&this.curSpot.spotClass=="img-spot"){var j=this.curSpot.$edSpot.find("> img").eq(0),f=this.curSpot.$edSpot.position().left,a=j.width(),e=this.curSpot.$edSpot.position().top,h=j.height(),b=Editor.$edImg.width(),n=Editor.$edImg.height();if(Math.round(f+a+4)==b){this.curSpot.coord[0]=f+4}if(Math.round(e+h+4)==n){this.curSpot.coord[1]=e+4}}var l;if(this.isLocalFile){var k=this.$prevImg.attr("src");$("#local-file-notice").show();this.$prevImg.attr("src","your image URL");l=this.$prevDiv.parent().html();this.$prevImg.attr("src",k);m=320}else{$("#local-file-notice").hide();l=this.$prevDiv.parent().html()}if($("#remove-formatting").is(":checked")){l=Editor.removeFormatting(l)}else{l=style_html(l)}$("#gcode-txt").val(l);$("#gcode-dialog").dialog("option")["height"]=m;$("#gcode-dialog").dialog("open")},loadCode:function(){var b=$($("#load-code-txt").val()),a=b.filter(".hs-area").eq(0),c=a.find("> img");if(!a.length){Editor.showError("There's no div Tag with class .hs-area");return}Editor.initNewImage(c.attr("src"));if(c.attr("data-imgdim")){$("#img-responsive").prop("checked",true)}a.find(".hs-wrap").each(function(){var k=$(this),m=k.find("div[data-coord]"),q=k.find(".tt-wrap > div"),n=m.attr("class"),d=m.attr("data-coord").split(","),p=m.attr("data-dim"),v=m.attr("data-activeon"),g=m.attr("data-handler"),f=m.attr("data-handleropts"),j=m.attr("data-name"),o=q.attr("data-width"),s=q.attr("data-dir"),t=q.attr("data-anim"),i=q.attr("data-pos"),u;u=new Spot(n,d[0],d[1]);u.$edSpot.css("left",d[0]+"px");u.$edSpot.css("top",d[1]+"px");if(n=="img-spot"){var e=m.find("> img").eq(0).attr("src"),h=m.find("> img").eq(1).attr("src");Editor.loadImgSpot(u,e,h)}if(p){var l=p.split(",");u.dim=[l[0],l[1],l[2]];u.$edSpot.width(l[0]);u.$edSpot.height(l[1]);if(l[2]){u.$edSpot.css("border-radius",l[2]+"px")}}u.options.spActiveon=v;u.options.spType=g?g:"General";u.options.spAnim=f?"false":null;var r=m.parent();if(r.is("a")){u.spLink=r.attr("href");if(r.attr("target")){u.spLinknWin=true}}u.options.spName=j;if(q.hasClass("tip-tooltip")){u.options.ttType="tip"}else{if(q.hasClass("bubble-tooltip")){u.options.ttType="bubble"}else{if(q.hasClass("aim-tooltip")){u.options.ttType="aim"}}}if(u.options.ttType=="aim"){u.ttContent=q.find(".tt-content").html()}else{u.ttContent=q.html()}u.options.ttWidth=o||"";u.options.ttDir=s||"top";u.options.ttAnim=t||"goin";u.options.ttPos=i||"";if(q.hasClass("white")){u.options.ttColor="white"}else{u.options.ttColor="black"}Editor.spotPool.push(u);u.$edSpot.bind("mousedown",function(){Editor.toggleSelect($(this).data("spotObj"))});if(u.spotClass!="sniper-spot"&&u.spotClass!="img-spot"){u.$edSpot.resizable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotDim,Editor)})}u.$edSpot.draggable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotPos,Editor)})})},delSpot:function(){if(!this.curSpot){return}this.curSpot.del();var a=this.spotPool.length-1;do{if(this.spotPool[a]===this.curSpot){this.spotPool.splice(a,1);delete this.curSpot;break}}while(a--);this.curSpot=null;this.hideOptionBar()},cloneSpot:function(){if(!this.curSpot){return}var b={w:this.$edImg.width(),h:this.$edImg.height()},g={w:this.curSpot.$edSpot.width(),h:this.curSpot.$edSpot.height()},a={x:parseFloat(this.curSpot.$edSpot.css("left")),y:parseFloat(this.curSpot.$edSpot.css("top"))},d={};this._saveOptions();d.x=((a.x+g.w+10)<b.w)?a.x+10:a.x-10;d.y=((a.y+g.h+10)<b.h)?a.y+10:a.y-10;var c=new Spot(this.curSpot.spotClass,d.x,d.y);c.options=$.extend({},this.curSpot.options);if(this.curSpot.spotClass!="sniper-spot"&&this.curSpot.spotClass!="img-spot"){c.$edSpot.width(g.w);c.$edSpot.height(g.h);c.dim=[g.w,g.h,this.curSpot.dim[2]];c.$edSpot.css("border-radius",this.curSpot.dim[2])}c.ttContent=this.curSpot.ttContent;c.spLink=this.curSpot.spLink;c.spLinknWin=this.curSpot.spLinknWin;if(this.curSpot.spotClass=="img-spot"){var f=this.curSpot.$edSpot.find("img").eq(0).attr("src"),e=this.curSpot.$edSpot.find("img").eq(1).attr("src");c.$edSpot.find("img").eq(0).attr("src",f);c.$prevSpot.find("img").eq(0).attr("src",f);c.$edSpot.find("img").eq(1).attr("src",e);c.$prevSpot.find("img").eq(1).attr("src",e)}this.newSpot(c)},imgSpotSave:function(){var a=$("#imgspot-1").val(),c=$("#imgspot-2").val(),b=this.curSpot.$edSpot.find("img").eq(0);if(!Editor.loadImgSpot(Editor.curSpot,a,c,false)){this.showError("One of images or both are not set");return}$("#imgspot-1").val("");$("#imgspot-2").val("");Editor.curSpot.$edSpot.data("img-spot-save",true);$("#img-spot-dialog").dialog("close")},loadImgSpot:function(e,a,d,c){var b=e.$edSpot.find("img").eq(0);if(!a||!d){return false}b.attr("src",a);e.$edSpot.find("img").eq(1).attr("src",d);e.$prevSpot.find("img").eq(0).attr("src",a);e.$prevSpot.find("img").eq(1).attr("src",d);if(!c){b.bind("load.boundaryCheck",function(){var i=$(this),m=e.$edSpot.position().left,j=i.width(),h=e.$edSpot.position().top,f=i.height(),g=Editor.$edImg.width(),n=Editor.$edImg.height();if(m+j+4>g){var l=parseFloat(e.$edSpot.css("left")),k=parseFloat(e.$edSpot.css("top"));e.$edSpot.css("left",g-j-4);e.coord=[l,k]}if(h+f+4>n){var l=parseFloat(e.$edSpot.css("left")),k=parseFloat(e.$edSpot.css("top"));e.$edSpot.css("top",n-f-4);e.coord=[l,k]}});if(b[0].complete){b.trigger("load.boundaryCheck")}}return true},ttContentSave:function(){this.curSpot.ttContent=$("#tt-content").val();$("#tt-content-dialog").dialog("close")},showError:function(a){$("#error-txt").text(a);$("#error-dialog").dialog("open")},focusSpotBtn:function(a){$(".spot-bar button").removeClass("btn-focus");$("#"+a+"-btn").addClass("btn-focus")},newSpot:function(a){this.spotPool.push(a);a.$edSpot.bind("mousedown",function(){Editor.toggleSelect($(this).data("spotObj"))});if(a.spotClass!="sniper-spot"&&a.spotClass!="img-spot"){a.$edSpot.resizable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotDim,Editor)})}a.$edSpot.draggable({containment:Editor.$edImg,stop:$.proxy(Editor.updateSpotPos,Editor)});this.optionBar.spAnim.prop("checked",true);this.toggleSelect(a)},toggleSelect:function(a){if(this.curSpot){this._saveOptions();this.curSpot.unselect()}this.curSpot=a;a.select();this._updateOptions();this.adjustOptionsBar();this.showOptionBar()},_updateOptions:function(){var a=this.curSpot.options;for(var b in this.optionBar){if(b=="spBradius"){if(this.curSpot.dim){this.optionBar.spBradius.val(this.curSpot.dim[2])}continue}if(a[b]===null){continue}if(b=="spAnim"){if(a.spAnim==="true"){this.optionBar.spAnim.prop("checked",true)}else{this.optionBar.spAnim.prop("checked",false)}}this.optionBar[b].val(a[b])}$("#sp-link").val(this.curSpot.spLink);if(this.curSpot.spLinknWin){$("#sp-link-n-win").prop("checked",true)}else{$("#sp-link-n-win").prop("checked",false)}},_saveOptions:function(){var a=this.curSpot.options;for(var b in this.optionBar){if(b=="spBradius"){if(this.isEnabled("spBradius")){this.curSpot.dim[2]=parseInt(this.optionBar.spBradius.val())}continue}if(!this.isEnabled(b)){a[b]=null;continue}if(b=="spAnim"){a[b]=this.optionBar[b].is(":checked").toString();continue}a[b]=this.optionBar[b].val()}},updateSpotDim:function(){var a=this.curSpot.$edSpot.outerWidth(),b=this.curSpot.$edSpot.outerHeight();if(this.curSpot.spotClass=="glass-spot"||this.curSpot.spotClass=="shadow-spot"){a=this.curSpot.$edSpot.outerWidth();b=this.curSpot.$edSpot.outerHeight()}else{a=this.curSpot.$edSpot.width();b=this.curSpot.$edSpot.height()}this.curSpot.dim[0]=a;this.curSpot.dim[1]=b},updateSpotPos:function(){var a=parseFloat(this.curSpot.$edSpot.css("left")),b=parseFloat(this.curSpot.$edSpot.css("top"));this.curSpot.coord=[a,b]},_enableOption:function(a){this.optionBar[a].parents("tr").css("display","")},_disableOption:function(a){this.optionBar[a].parents("tr").css("display","none")},isEnabled:function(a){if(this.optionBar[a].parents("tr").css("display")=="none"){return false}else{return true}},showOptionBar:function(){$(".spot-options").show()},hideOptionBar:function(){$(".spot-options").hide()},adjustOptionsBar:function(){if(this.optionBar.spType.val()=="General"){this._disableOption("spAnim");this._enableOption("ttType");this._enableOption("ttAnim");this._enableOption("ttWidth");this._enableOption("ttPos");if(this.optionBar.ttType.val()=="tip"){this._enableOption("ttDir");this._enableOption("ttColor")}else{this._disableOption("ttDir");this._disableOption("ttColor")}}if(this.optionBar.spType.val()=="Aim"){this._enableOption("spAnim");this._disableOption("ttType");this._disableOption("ttAnim");this._enableOption("ttDir");if(this.optionBar.ttDir.val()=="right"||this.optionBar.ttDir.val()=="left"){this._enableOption("ttWidth")}else{this._disableOption("ttWidth")}this._disableOption("ttPos");this._disableOption("ttColor")}if(this.curSpot.spotClass=="sniper-spot"||this.curSpot.spotClass=="img-spot"||this.curSpot.spotClass=="invisible-spot"){this._disableOption("spBradius")}else{this._enableOption("spBradius")}if(this.curSpot.spotClass=="invisible-spot"||this.curSpot.spotClass=="onhover-spot"){this.optionBar.spActiveon.find("option").eq(1).attr("disabled","")}else{this.optionBar.spActiveon.find("option").eq(1).removeAttr("disabled")}},optionChange:function(){this.adjustOptionsBar();this._saveOptions()},removeFormatting:function(b){var a;a=b.replace(/\r|\n/gm,"");a=a.replace(/>\s+</gm,"><");return a},bindHotKeys:function(){$(document).delegate(".ui-dialog","keyup",function(b){var a=b.target.tagName.toLowerCase();a=(a=="input"&&b.target.type=="button")?"button":a;if(b.which==$.ui.keyCode.ENTER&&a!="textarea"&&a!="select"&&a!="button"){$(this).find("button").eq(0).trigger("click");return false}});$(document).bind("keydown",function(a){if(a.ctrlKey&&a.altKey){Editor.togglePreview()}});Editor.$edDiv.bind("click",function(){$(this).focus()});Editor.$edDiv.bind("keydown",function(d){if(Editor.curSpot){var g;switch(d.which){case $.ui.keyCode.UP:g=parseFloat(Editor.curSpot.$edSpot.css("top"));if(g>0){Editor.curSpot.$edSpot.css("top",g-1);Editor.updateSpotPos()}d.preventDefault();break;case $.ui.keyCode.DOWN:var f,c;g=parseFloat(Editor.curSpot.$edSpot.css("top"));f=Editor.$edImg.height();c=Editor.curSpot.$edSpot.outerHeight();if(g+c<f){Editor.curSpot.$edSpot.css("top",g+1);Editor.updateSpotPos()}d.preventDefault();break;case $.ui.keyCode.RIGHT:var b,a;g=parseFloat(Editor.curSpot.$edSpot.css("left"));b=Editor.$edImg.width();a=Editor.curSpot.$edSpot.outerWidth();if(g+a<b){Editor.curSpot.$edSpot.css("left",g+1);Editor.updateSpotPos()}d.preventDefault();break;case $.ui.keyCode.LEFT:g=parseFloat(Editor.curSpot.$edSpot.css("left"));if(g>0){Editor.curSpot.$edSpot.css("left",g-1);Editor.updateSpotPos()}d.preventDefault();break}}});Editor.$edDiv.bind("keyup",function(a){if(a.which==$.ui.keyCode.DELETE&&Editor.curSpot){Editor.delSpot();a.preventDefault()}if(a.ctrlKey&&a.which==67&&Editor.curSpot){Editor.cloneSpot();a.preventDefault()}})}};$(document).ready($.proxy(Editor.init,Editor));